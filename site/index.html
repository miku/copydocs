<!DOCTYPE html>
<html>
<head>
    <title>Hi</title>

    <!-- Basic Page Needs
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <title>copydocs</title>
    <meta name="description" content="copydocs">
    <meta name="author" content="copydocs">

    <!-- Mobile Specific Metas
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FONT
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

    <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/app.css">

    <!-- Favicon
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/png" href="images/favicon.png">

    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/mustache.min.js" ></script>
    <script src="js/sugar.min.js"></script>
    <script src="js/elasticsearch.jquery.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            // console.log( "ready!" );

            function truncate(string, length){
               if (string.length > length)
                  return string.substring(0, length) + '...';
               else
                  return string;
            };

            // main entry point
            $("#q").focus();

            // update on search
            $("#q").keyup(function(e) {

                // if (e.KeyCode == 13) {
                //     console.log("ENTER");
                // }

                var queryString = $("#q").val();
                // console.log(queryString);

                var client = new $.es.Client({
                  hosts: 'localhost:9200'
                });

                client.search({
                  q: queryString,
                  size: 100,
                }).then(function (body) {

                var results = Array();

                for (var i = 0; i < body.hits.hits.length; i++) {
                    var entry = {
                        'title' : body.hits.hits[i]._source.info.title,
                        'url' : body.hits.hits[i]._source.page.url,
                        'abstract': truncate(body.hits.hits[i]._source.page.abstract, 300),
                        'year': body.hits.hits[i]._source.info.year,
                    }
                    results.push(entry);
                }
                    

                  var template = $('#template').html();
                  var rendered = Mustache.render(template, {
                    results: results
                  });
                  $('#r').html(rendered);

                  $('#count').html(body.hits.total);

                }, function (error) {
                  console.trace(error.message);
                });

            });
        });

    </script>
</head>

<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
        <div class="row">
            <div class="ten columns">
                <h1>copydocs</h1>
                <p>Search through copyright relevant documents quickly.</p>
                <!-- input -->
                <input id="q" class="u-full-width" type="text" name="search">

                <p><span id="count">0</span> result(s).</p>

                <!-- results -->
                <ul id="r">
                </ul>

                <script id="template" type="x-tmpl-mustache">
                    {{#results}}
                        <li>
                            <b>{{ title }}</b> &mdash; {{ year }}<br>
                            <a href="{{ url }}">{{ url }}</a><br>
                            {{ abstract }}

                        </li>
                    {{/results}}
                </script>
                
            </div>
        </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    


</body>
</html>
